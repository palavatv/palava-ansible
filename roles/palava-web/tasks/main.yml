---

- name: Install node.js
  include: nodesource.yml

- name: Install other required packages
  apt:
    name:
      - nginx
    state: present

- name: Create palava-web directory
  file:
    path: "{{ palava_web_install_dir }}"
    state: directory
    owner: www-data
    group: www-data
    mode: 0775

- name: Checkout palava-web source
  git:
    repo: "{{ palava_web_repo }}"
    dest: "{{ palava_web_install_dir }}"
    version: "{{ palava_web_version }}"

- name: Install palava-web dependencies
  community.general.yarn:
    path: "{{ palava_web_install_dir }}"

- name: Build palava-web frontend
  shell: "VUE_APP_RTC_URL='{{ palava_web_rtc_url }}' VUE_APP_TURN_URLS='{{ palava_web_turn_urls }}' VUE_APP_STUN_URL='{{ palava_web_stun_url }}' yarn build"
  args:
    chdir: "{{ palava_web_install_dir }}"